!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/cdk/drag-drop"),require("rxjs"),require("@angular/common/http"),require("@angular/forms"),require("@angular/material/dialog"),require("rxjs/operators"),require("@angular/common"),require("@angular/material/button"),require("@angular/material/icon"),require("@angular/material/menu"),require("@angular/material/table"),require("@angular/material/paginator"),require("@angular/cdk/overlay"),require("@angular/material/select"),require("@angular/material/list"),require("@angular/material/checkbox"),require("@angular/material/sort"),require("@angular/material/input"),require("@angular/material/datepicker"),require("@angular/material/chips"),require("@angular/material/progress-bar")):"function"==typeof define&&define.amd?define("@stamtech/datatable-utils",["exports","@angular/core","@angular/cdk/drag-drop","rxjs","@angular/common/http","@angular/forms","@angular/material/dialog","rxjs/operators","@angular/common","@angular/material/button","@angular/material/icon","@angular/material/menu","@angular/material/table","@angular/material/paginator","@angular/cdk/overlay","@angular/material/select","@angular/material/list","@angular/material/checkbox","@angular/material/sort","@angular/material/input","@angular/material/datepicker","@angular/material/chips","@angular/material/progress-bar"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).stamtech=t.stamtech||{},t.stamtech["datatable-utils"]={}),t.ng.core,t.ng.cdk.dragDrop,t.rxjs,t.ng.common.http,t.ng.forms,t.ng.material.dialog,t.rxjs.operators,t.ng.common,t.ng.material.button,t.ng.material.icon,t.ng.material.menu,t.ng.material.table,t.ng.material.paginator,t.ng.cdk.overlay,t.ng.material.select,t.ng.material.list,t.ng.material.checkbox,t.ng.material.sort,t.ng.material.input,t.ng.material.datepicker,t.ng.material.chips,t.ng.material.progressBar)}(this,(function(t,e,r,i,n,o,a,l,s,c,u,m,p,f,d,h,g,b,v,y,S,k,F){"use strict";var C=function(){function t(){this.menuVisible=!1,this.columns=[],this.columnsChange=new e.EventEmitter,this.selectedColumns=[],this.selectedColumnsChange=new e.EventEmitter}return t.prototype.ngOnInit=function(){},t.prototype.toggleSelector=function(){this.menuVisible=!this.menuVisible},t.prototype.closeMenu=function(){this.menuVisible=!1,this.selectedColumnsChange.emit(this.selectedColumns)},t.prototype.drop=function(t){var e=this.columns[t.previousIndex],i=this.columns[t.currentIndex];r.moveItemInArray(this.columns,t.previousIndex,t.currentIndex);var n=this.selectedColumns.indexOf(e.key),o=this.selectedColumns.indexOf(i.key);-1!=n&&-1!=o&&r.moveItemInArray(this.selectedColumns,n,o)},t}();C.decorators=[{type:e.Component,args:[{selector:"column-selector",template:'<button\r\n    mat-icon-button\r\n    color="primary"\r\n    (click)="toggleSelector()"\r\n    cdkOverlayOrigin #trigger="cdkOverlayOrigin">\r\n    <mat-icon aria-label="Columns">view_column</mat-icon>\r\n</button>\r\n<ng-template\r\n  cdkConnectedOverlay\r\n  [cdkConnectedOverlayOrigin]="trigger"\r\n  [cdkConnectedOverlayOpen]="menuVisible"\r\n  [cdkConnectedOverlayHasBackdrop]="true"\r\n  (backdropClick)="closeMenu()">\r\n    <mat-selection-list class="column-list mat-elevation-z8"\r\n        [(ngModel)]="selectedColumns"\r\n        cdkDropList  (cdkDropListDropped)="drop($event)">\r\n        <mat-list-option *ngFor="let column of columns" \r\n            class="column-item" \r\n            checkboxPosition="before"  \r\n            [disabled]="column.locked"\r\n            [value]="column.key"\r\n            cdkDrag>\r\n            <div class="columnItem">\r\n              <span>{{column.label}} </span>\r\n              <mat-icon>drag_handle</mat-icon>\r\n            </div>\r\n          </mat-list-option>\r\n    </mat-selection-list>\r\n</ng-template>\r\n',styles:[".column-list{min-width:200px;max-width:100%;border:1px solid #ccc;max-height:350px;display:block;background:#eee;overflow-y:auto}.cdk-drag-preview{display:flex;height:48px;-webkit-tap-highlight-color:transparent;width:100%;padding:0;position:relative}.cdk-drag-placeholder{opacity:0}.cdk-drag-animating{transition:transform .25s cubic-bezier(0,0,.2,1)}.columnItem{display:flex;justify-content:space-between}.columnItem mat-icon{cursor:-webkit-grab;cursor:grab}"]}]}],C.ctorParameters=function(){return[]},C.propDecorators={columns:[{type:e.Input}],columnsChange:[{type:e.Output}],selectedColumns:[{type:e.Input}],selectedColumnsChange:[{type:e.Output}]};var x,M=function(t,e,r,i){this.value=null,this.disabled=!1,this.key=t,this.label=e,this.type=r,i&&(this.options=i.map((function(t){return"string"==typeof t?{id:t,label:t}:t})))};(x=t.FilterType||(t.FilterType={})).TEXT="TEXT",x.SELECT="SELECT",x.DATE="DATE";var w=function(){function t(){this.filters={},this.limit=10,this.page=null,this.sortField=null,this.sortDirection="Desc"}return t.prototype.find=function(t){return this.filters[t]},t.prototype.add=function(t){this.filters[t.key]=t},t.prototype.remove=function(t){delete this.filters[t]},t.prototype.isActive=function(){return this.getActiveFilters().length>0},t.prototype.clear=function(){var t=this;Object.keys(this.filters).forEach((function(e){t.filters[e].value=null}))},t.prototype.reset=function(){this.filters={}},t.prototype.getActiveFilters=function(){return Object.values(this.filters).filter((function(t){return null!==t.value&&void 0!==t.value}))},t.prototype.getParams=function(){console.log(this);var t=new n.HttpParams;return null!==this.page&&(t=(t=t.append("page",this.page.toString())).append("limit",this.limit.toString())),this.sortField&&(t=(t=t.append("sort",this.sortField.toString())).append("direction",this.sortDirection.toString())),this.filters&&this.getActiveFilters().forEach((function(e){return t=t.append(e.key,e.value)})),t},t.prototype.setSort=function(t,e){this.sortField=t,this.sortDirection=e,this.resetPage()},t.prototype.resetPage=function(){this.page&&(this.page=0)},t}(),j=function(){function t(){this.filterSet=new w,this.filterSetSubject=new i.BehaviorSubject(this.filterSet),this.filterSet$=this.filterSetSubject.asObservable()}return t.prototype.emitFilters=function(){this.filterSetSubject.next(this.filterSet)},t.prototype.addFilter=function(t,e,r,i){this.filterSet.add(new M(t,e,r,i)),this.emitFilters()},t.prototype.removeFilter=function(t){this.filterSet.remove(t),this.emitFilters()},t.prototype.setFilter=function(t,e){var r=this.filterSet.find(t);r&&(r.value=e,this.emitFilters())},t.prototype.clearFilter=function(t){this.setFilter(t,null)},t.prototype.updateFilters=function(t){this.filterSet=t,this.emitFilters()},t.prototype.isActive=function(){return this.filterSet.isActive()},t.prototype.disableFilter=function(t){var e=this.filterSet.find(t);e&&(e.disabled=!0,this.emitFilters())},t.prototype.enableFilter=function(t){var e=this.filterSet.find(t);e&&(e.disabled=!1,this.emitFilters())},t.prototype.clearFilters=function(){this.filterSet.clear(),this.emitFilters()},t.prototype.setPage=function(t,e){this.filterSet.page=t,e&&(this.filterSet.limit=e),this.emitFilters()},t.prototype.setLimit=function(t){this.filterSet.limit=t,this.emitFilters()},t.prototype.setSort=function(t,e){this.filterSet.sortField=t,this.filterSet.sortDirection=e,this.emitFilters()},t}(),D=function(){function t(t){var e=this;this.filtersService=t,this.chips=[],this.filtersService.filterSet$.subscribe((function(t){return e.chips=t.getActiveFilters()}))}return t.prototype.clear=function(t){this.filtersService.clearFilter(t)},t.prototype.clearFilters=function(){this.filtersService.clearFilters()},t}();D.decorators=[{type:e.Component,args:[{selector:"stam-chips-filter",template:'<div class="infobox-container" *ngIf="chips.length">\r\n    <div class="mat-header-cell filter-header-label" >Filtri attivi : </div>\r\n    <mat-chip-list>\r\n        <mat-chip *ngFor="let chip of chips" \r\n            color="primary"\r\n            selected="true"\r\n            (removed)="clear(chip.key)">\r\n            <mat-icon matChipRemove>cancel</mat-icon>\r\n            {{chip.label}} <span class="chipValue">{{chip.value}}</span>\r\n        </mat-chip>\r\n    </mat-chip-list>\r\n    <div class="action-container">\r\n        <button mat-button color="accent" (click)="clearFilters()">Cancella filtri</button>\r\n    </div>\r\n</div>\r\n\r\n',styles:[".infobox-container{display:flex;align-items:center;min-height:56px;width:100%;background:#fff;border-bottom:1px solid rgba(0,0,0,.12)}.infobox-container .filter-header-label{width:8em;margin:0 24px}.infobox-container mat-chip-list{flex-grow:1;margin:1em 0}.infobox-container mat-chip-list .chipValue{background-color:hsla(0,0%,100%,.5);padding:7px 16px;border-radius:16px;margin-left:8px;margin-right:-12px;line-height:19px;max-width:8em;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.infobox-container mat-chip-list mat-icon{margin-left:0!important;margin-right:8px!important}"]}]}],D.ctorParameters=function(){return[{type:j}]};var O=function(){function t(t,e){var r=this;this.dialog=t,this.data=e,this.filtersForm=new o.FormGroup({}),this.filtersService=e.filtersService,this.filtersService.filterSet$.subscribe((function(t){r.filterSet=t,Object.keys(r.filterSet.filters).forEach((function(t){return r.filtersForm.addControl(t,new o.FormControl({value:r.filterSet.filters[t].value,disabled:r.filterSet.filters[t].disabled}))}))}))}return t.prototype.clearFilters=function(){this.filtersForm.reset()},t.prototype.search=function(){var t=this;Object.keys(this.filtersForm.controls).forEach((function(e){var r=t.filterSet.find(e);r&&(r.value=t.filtersForm.controls[e].value)})),this.filterSet.resetPage(),this.filtersService.updateFilters(this.filterSet),this.dialog.close()},t}();O.decorators=[{type:e.Component,args:[{selector:"app-dialog-filter",template:'<h2 mat-dialog-title>Filtri</h2>\r\n<div mat-dialog-content>\r\n    <form [formGroup]="filtersForm">        \r\n        <div *ngFor="let filter of filterSet.filters | keyvalue">\r\n            <ng-container [ngSwitch]="filter.value.type">\r\n                <ng-container *ngSwitchCase="\'TEXT\'">\r\n                    <mat-form-field>\r\n                        <mat-label>{{ filter.value.label }}</mat-label>\r\n                        <input matInput [formControlName]="filter.key">\r\n                    </mat-form-field>\r\n                </ng-container>\r\n                <ng-container *ngSwitchCase="\'SELECT\'">\r\n                    <mat-form-field>\r\n                        <mat-label>{{ filter.value.label }}</mat-label>\r\n                        <mat-select [formControlName]="filter.key">\r\n                            <mat-option [value]="">---</mat-option> \r\n                            <mat-option *ngFor="let opt of filter.value.options" [value]="opt.id">\r\n                                {{ opt.label }}\r\n                            </mat-option>\r\n                        </mat-select>\r\n                    </mat-form-field>\r\n                </ng-container>\r\n                <ng-container *ngSwitchCase="\'DATE\'">\r\n                    <mat-form-field>\r\n                        <mat-label>{{ filter.value.label }}</mat-label>\r\n                        <input matInput [matDatepicker]="picker" [formControlName]="filter.key">\r\n                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>\r\n                        <mat-datepicker #picker></mat-datepicker>\r\n                    </mat-form-field>\r\n                </ng-container>\r\n            </ng-container>\r\n        </div>\r\n    </form>\r\n</div>\r\n<mat-dialog-actions align="end">\r\n    <button class="clear-filters-button" mat-raised-button (click)="clearFilters()">Reset</button>\r\n    <button class="search-filters-button" mat-raised-button color="primary" (click)="search()">Ricerca</button>\r\n</mat-dialog-actions>',styles:[".mat-form-field { width: 100% }"]}]}],O.ctorParameters=function(){return[{type:a.MatDialogRef},{type:void 0,decorators:[{type:e.Inject,args:[a.MAT_DIALOG_DATA]}]}]};var E=function(t,e){this.key=t,this.label=e,this.visible=!0,this.locked=!1,this.customContent=!1,this.sortable=t},q=function(){function t(){this.columns={}}return t.prototype.addColumn=function(t,e){this.columns[t]=new E(t,e)},t.prototype.setVisible=function(t,e){var r=this;void 0===e&&(e=!0),t.forEach((function(t){r.columns[t].visible=e}))},t.prototype.setLocked=function(t,e){var r=this;void 0===e&&(e=!0),t.forEach((function(t){r.columns[t].locked=e}))},t.prototype.setCustom=function(t,e){var r=this;void 0===e&&(e=!0),t.forEach((function(t){r.columns[t].customContent=e}))},t.prototype.setSortable=function(t,e){var r=this;void 0===e&&(e=""),t.forEach((function(t){r.columns[t].sortable=e}))},t.prototype.getColumns=function(){return Object.values(this.columns)},t.prototype.getDisplayedColumns=function(){return Object.values(this.columns).filter((function(t){return t.visible})).map((function(t){return t.key}))},t.prototype.getStandardColumns=function(){return Object.values(this.columns).filter((function(t){return!t.customContent}))},t}(),I=function(){this.content=[],this.totalElements=0},T=function(){function t(t){this.rowsService=t,this.rows=new i.BehaviorSubject([]),this.loadingSubject=new i.BehaviorSubject(!1),this.loading$=this.loadingSubject.asObservable(),this.countSubject=new i.BehaviorSubject(0),this.counter$=this.countSubject.asObservable()}return t.prototype.connect=function(t){return this.rows.asObservable()},t.prototype.disconnect=function(t){this.rows.complete(),this.loadingSubject.complete(),this.countSubject.complete()},t.prototype.loadData=function(t){var e=this;this.loadingSubject.next(!0),this.rowsService.findAll(t).pipe(l.catchError((function(){return i.of(new I)})),l.finalize((function(){return e.loadingSubject.next(!1)}))).subscribe((function(t){e.rows.next(t.content),e.countSubject.next(t.totalElements)}))},t}(),A=function(){};A.decorators=[{type:e.NgModule,args:[{declarations:[C,O,D],imports:[s.CommonModule,S.MatDatepickerModule,y.MatInputModule,o.FormsModule,o.ReactiveFormsModule,m.MatMenuModule,u.MatIconModule,c.MatButtonModule,d.OverlayModule,p.MatTableModule,f.MatPaginatorModule,h.MatSelectModule,r.DragDropModule,g.MatListModule,b.MatCheckboxModule,v.MatSortModule,a.MatDialogModule,k.MatChipsModule,F.MatProgressBarModule],exports:[C,O,D]}]}],t.ChipsFilterComponent=D,t.ColumnFilterService=j,t.ColumnSelectorComponent=C,t.ColumnsManagerService=q,t.DatatableColumn=E,t.DatatableDatasource=T,t.DialogFilterComponent=O,t.Filter=M,t.FilterSet=w,t.RowsResponse=I,t.StamDatatableModule=A,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=stamtech-datatable-utils.umd.min.js.map